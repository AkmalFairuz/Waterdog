From 4f3d178759b834d0880e0d856bb69e0e73ccfdc7 Mon Sep 17 00:00:00 2001
From: Colin Godsey <crgodsey@gmail.com>
Date: Wed, 17 Apr 2019 06:51:16 -0600
Subject: [PATCH] IntrospectionEvent


diff --git a/api/src/main/java/network/ycc/waterdog/event/IntrospectionEvent.java b/api/src/main/java/network/ycc/waterdog/event/IntrospectionEvent.java
new file mode 100644
index 00000000..6e66b01d
--- /dev/null
+++ b/api/src/main/java/network/ycc/waterdog/event/IntrospectionEvent.java
@@ -0,0 +1,18 @@
+package network.ycc.waterdog.event;
+
+import io.netty.channel.Channel;
+
+import lombok.AllArgsConstructor;
+import lombok.EqualsAndHashCode;
+
+import net.md_5.bungee.api.config.ServerInfo;
+import net.md_5.bungee.api.connection.ProxiedPlayer;
+import net.md_5.bungee.api.plugin.Event;
+
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class IntrospectionEvent extends Event {
+    private ProxiedPlayer user;
+    private ServerInfo serverInfo;
+    private Channel channel;
+}
diff --git a/proxy/src/main/java/net/md_5/bungee/UserConnection.java b/proxy/src/main/java/net/md_5/bungee/UserConnection.java
index 0efb227e..876b2386 100644
--- a/proxy/src/main/java/net/md_5/bungee/UserConnection.java
+++ b/proxy/src/main/java/net/md_5/bungee/UserConnection.java
@@ -369,6 +369,7 @@ public final class UserConnection implements ProxiedPlayer
                         ch.pipeline().addLast(network.ycc.waterdog.pe.PEDecompressor.NAME, new network.ycc.waterdog.pe.PEDecompressor());
                     }
                 }
+                bungee.getPluginManager().callEvent(new network.ycc.waterdog.event.IntrospectionEvent(UserConnection.this, request.getTarget(), ch));
                 // Waterdog end
                 PipelineUtils.BASE.initChannel( ch );
                 ch.pipeline().addAfter( PipelineUtils.FRAME_DECODER, PipelineUtils.PACKET_DECODER, new MinecraftDecoder( Protocol.HANDSHAKE, false, getPendingConnection().getVersion(), bungee.getConfig().isAllowEmptyPackets() ) ); // Waterfall
-- 
2.17.2 (Apple Git-113)

